

Настроить мониторинг контейнера.. через с advisor Там по лучьше графики можно будет сделать !!

Поднастроить графану что бы реплки и нагрузка на реплики, где-то в начале отображалась 
Вопрос по репликам, после того как 2 реплика создалась, порог нагрузки такой же ? что бы 3 реплика создалась и на какой порог надо смотреть ? Думаю что на среднее число между всеми репликами 




Надо сделать 
2 стеэка 
- первый стек уже работает это стек мониторинга  промитеус графана кодвижер... 
- Второй стек это само приложение.. т.н там в принципе стек ввиде одной команды.. НО что бы оно работало надо собрать образ приложения и залить его на репозиторий !! 
  Тут в каждом контейнере должны быть метки кол-во запросов 

- Надо в графане научится выводить графики с кол-во приложения !!! т.е ты его меняешь и тут же меняеться это в графане !! 
  Хотя тут же оно не поменяеться.. 
  Т.е сделать общий график..   


План 
- Сделать отправку алертов из промитеуса при нагрузке 
- Сделать сервер http для приема алертов из промитеса 
- Сделать скрипты на питоне который может изменять кол-во реплик (подключить докер в питон)
- Добавить свой микросервис (надо на докер хаб его выложить)

Результат
- Добавил в стек alertmanager 
- Причесал проект 
- Настроил alertmanager  
- Сделал http server который ловит сообщения от alertmanager  
- Заменил nginx на своё приложение 
- Собрал приложение и залил на докер хаб 
- Сделал в приложении запрос на эмитацию нагрузки в 100 MБ   http://45.12.19.151/memory-heavy
- Сделал


Надо сделать уменьшение кол-во реплик при уменьшении нагрузки ? 
Правильнее сделать через скрипт питона 
т.е после того как он принял ошибку 
скрипт периодически опрашивает через промитеус все контейнеры 
и смотрит нагрузку на них если нагрузка на контейнеров меньше 10% то уменьшает кол-во контейнеров 
Через текекущую эмуляцию такое не проверить.. 

Может сделать правильную эмуляцию ? через JMeter ... сделать запросы которые отедают по 1 МБ памяти в течении 1-2 сек 
И через JMeter настроить нагрузку.. 
В принципе не плохо только один ньанс третьему контейнеру некуд разворачиваться.. надо брать еще 3 сервер либо повышать ОЗУ на 1-2 воркере ВОт это дешевли будет до 3 гигов добавить и норм будет 






Сделать еще одно правила на <128 МБ  ?  всегда что ли будет отправлять ?












Команды для работы с стеком приложения 
docker stack deploy -c Autoscaler/app/nginx-app-stack.yml nginx-app
docker service scale nginx-app=5
docker service rm nginx-app_my-nginx


Команды для работы с стеком мониторинга 
docker stack deploy -c monitoring/monitoring-stack.yml monitoring
docker stack services monitoring/

docker stack rm monitoring


